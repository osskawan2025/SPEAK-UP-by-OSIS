<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Admin ‚Äî Pesan & Aspirasi OSIS</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:'Poppins',sans-serif;background:#0b1020;color:#e6eef8;min-height:100vh;padding:32px}
    .container{max-width:900px;margin:auto}
    h1{text-align:center;margin-bottom:20px}
    .card{background:rgba(255,255,255,0.04);border-radius:16px;padding:24px;margin-bottom:18px;box-shadow:0 8px 24px rgba(0,0,0,0.4)}
    .msg{border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:14px;margin-bottom:12px;background:rgba(255,255,255,0.02);cursor:pointer;transition:all .2s ease}
    .msg:hover{background:rgba(255,255,255,0.05);transform:scale(1.01)}
    .meta{font-size:13px;color:#9aa6b2;margin-top:6px;display:flex;justify-content:space-between}
    button{cursor:pointer;border:none;border-radius:8px;padding:6px 10px;font-weight:600;transition:0.2s}
    .danger{background:#ef4444;color:#fff}
    .refresh{background:#3b82f6;color:#fff;margin-right:8px}
    .muted{color:#9aa6b2;font-size:13px;margin-top:10px;text-align:center}
    .empty{text-align:center;color:#9aa6b2;margin-top:40px}
    .info{color:#9aa6b2;font-size:12px;text-align:right;margin-top:-5px;margin-bottom:8px}

    /* Popup tampilan pesan */
    .popup{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(4px);animation:fadeIn .25s ease}
    .popup-card{background:#fff;color:#111;padding:32px 24px;border-radius:20px;max-width:500px;width:90%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.3);position:relative;animation:zoomIn .25s ease}
    .popup-card h2{margin-bottom:12px;font-size:18px;color:#333}
    .popup-card p{font-size:16px;margin-bottom:10px;white-space:pre-wrap;color:#222}
    .popup-card small{color:#555;font-size:13px}
    .popup-card button.close-btn{position:absolute;top:8px;right:8px;background:#ef4444;color:#fff;padding:6px 10px;border:none;border-radius:8px;cursor:pointer}
    .popup-card button.screenshot-btn{background:#3b82f6;color:#fff;margin-top:16px;border:none;border-radius:8px;padding:8px 14px;cursor:pointer}
    .popup-card.clean-mode .close-btn,
    .popup-card.clean-mode .screenshot-btn{display:none}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes zoomIn{from{transform:scale(0.95)}to{transform:scale(1)}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Panel Admin SPEAK UP! by OSIS</h1>
    <div class="card">
      <label for="adminPass">Kunci Admin:</label>
      <input id="adminPass" placeholder="Masukkan kunci admin..." style="width:100%;padding:8px;border-radius:8px;margin-top:6px;background:transparent;border:1px solid rgba(255,255,255,0.1);color:#fff">
      <button id="unlock" style="margin-top:10px" class="danger">Masuk</button>
      <div class="muted">Gunakan kunci khusus sekbid TIK: <code>rahasia-osis-2025</code></div>
    </div>

    <div id="adminArea" style="display:none">
      <div style="text-align:right;margin-bottom:10px;display:flex;justify-content:flex-end;gap:8px">
        <button id="refreshBtn" class="refresh">üîÑ Refresh</button>
        <button id="clearAll" class="danger">Hapus Semua Pesan</button>
      </div>
      <div class="info">Auto-refresh setiap 1 detik ‚è±Ô∏è</div>
      <div id="messages"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY='osis_pesan_2025_v1';
    const ADMIN_KEY='osis_admin_2025_v1';
    const adminArea=document.getElementById('adminArea');
    const messagesDiv=document.getElementById('messages');
    const unlock=document.getElementById('unlock');
    const pass=document.getElementById('adminPass');
    const clearAll=document.getElementById('clearAll');
    const refreshBtn=document.getElementById('refreshBtn');

    function load(){
      const raw=localStorage.getItem(STORAGE_KEY);
      try{return raw?JSON.parse(raw):[]}catch{return[]}
    }
    function save(list){localStorage.setItem(STORAGE_KEY,JSON.stringify(list))}
    function isAdmin(){return localStorage.getItem(ADMIN_KEY)===btoa('osed_admin_key_2025')}

    function render(){
      const list=load().slice().reverse();
      messagesDiv.innerHTML='';
      if(list.length===0){
        messagesDiv.innerHTML='<div class="empty">Belum ada pesan</div>';
        return;
      }
      list.forEach((m,i)=>{
        const div=document.createElement('div');
        div.className='msg';
        div.innerHTML=`<div>${escapeHtml(m.text)}</div>
          <div class="meta"><span>${m.name||'Anonim'}</span><span>${new Date(m.ts).toLocaleString()}</span></div>
          <button class="danger" style="margin-top:6px">Hapus</button>`;
        div.querySelector('button').onclick=(e)=>{
          e.stopPropagation();
          deleteAt((load().length-1)-i);
        };
        div.onclick=()=>showPopup(m);
        messagesDiv.appendChild(div);
      });
    }

    function deleteAt(idx){
      const list=load();
      list.splice(idx,1);
      save(list);
      render();
    }

    unlock.addEventListener('click',()=>{
      if(pass.value==='rahasia-osis-2025'){
        localStorage.setItem(ADMIN_KEY,btoa('osed_admin_key_2025'));
        adminArea.style.display='block';
        render();
        startAutoRefresh();
      }else alert('Kunci salah!');
    });

    clearAll.addEventListener('click',()=>{
      if(confirm('Hapus semua pesan?')){
        localStorage.removeItem(STORAGE_KEY);
        render();
      }
    });

    refreshBtn.addEventListener('click',()=>{
      render();
      refreshBtn.textContent='‚úÖ Diperbarui';
      setTimeout(()=>refreshBtn.textContent='üîÑ Refresh',1500);
    });

    // AUTO REFRESH setiap 1 detik
    let autoRefreshTimer;
    function startAutoRefresh(){
      if(autoRefreshTimer) clearInterval(autoRefreshTimer);
      autoRefreshTimer=setInterval(render,1000);
    }

    // Popup pesan
    function showPopup(msg){
      const popup=document.createElement('div');
      popup.className='popup';
      popup.innerHTML=`
        <div class="popup-card">
          <button class="close-btn">&times;</button>
          <h4>SPEAK UP! by OSIS</h4>
          <p>${escapeHtml(msg.text)}</p>
          <small>${new Date(msg.ts).toLocaleDateString()}</small>
          <button class="screenshot-btn">üì∏ Siap Screenshot</button>
        </div>`;
      document.body.appendChild(popup);

      const card=popup.querySelector('.popup-card');
      const closeBtn=popup.querySelector('.close-btn');
      const ssBtn=popup.querySelector('.screenshot-btn');

      closeBtn.onclick=()=>popup.remove();
      ssBtn.onclick=()=>{
        card.classList.add('clean-mode');
        setTimeout(()=>alert('Mode screenshot aktif ‚Äî ambil tangkapan layar sekarang!'),100);
      };

      popup.addEventListener('click',e=>{
        if(e.target===popup)popup.remove();
      });
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g,m=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }
  </script>
</body>
</html>
